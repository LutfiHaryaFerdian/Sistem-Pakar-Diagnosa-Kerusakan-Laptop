{% extends "base.html" %} {% block content %}

<div class="max-w-6xl mx-auto">
  <!-- Header Section -->
  <div class="mb-8 fade-in-up">
    <div class="flex items-center justify-between flex-wrap gap-4">
      <div>
        <h3 class="text-3xl font-bold text-white mb-2 flex items-center gap-3">
          <i class="bi bi-exclamation-triangle text-amber-400"></i>
          Data Kerusakan Laptop
        </h3>
        <p class="text-slate-400">
          Daftar jenis kerusakan yang dapat terdeteksi
        </p>
      </div>
      <div class="text-right">
        <div class="text-2xl font-bold text-amber-400" id="totalKerusakan">
          {{ faults|length }}
        </div>
        <div class="text-sm text-slate-400">Total Kerusakan</div>
      </div>
    </div>
  </div>

  <!-- Search & Filter Section -->
  <div
    class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-6 mb-6 fade-in-up stagger-1"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Search Bar -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">
          <i class="bi bi-search"></i> Cari Kerusakan
        </label>
        <div class="relative">
          <input
            type="text"
            id="searchInput"
            placeholder="Ketik untuk mencari kerusakan..."
            class="bg-slate-700/50 border border-slate-600/50 text-slate-200 text-sm rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 block w-full pl-10 pr-10 py-2.5 transition-all"
          />
          <i
            class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"
          ></i>
          <button
            id="clearSearch"
            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-amber-400 transition-colors hidden"
          >
            <i class="bi bi-x-circle-fill"></i>
          </button>
        </div>
      </div>

      <!-- View Mode -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">
          <i class="bi bi-grid"></i> Mode Tampilan
        </label>
        <div class="flex gap-2">
          <button
            id="tableViewBtn"
            class="flex-1 px-4 py-2.5 bg-amber-500/20 border border-amber-500/30 text-amber-400 rounded-lg text-sm font-medium transition-all hover:bg-amber-500/30"
          >
            <i class="bi bi-table"></i> Tabel
          </button>
          <button
            id="cardViewBtn"
            class="flex-1 px-4 py-2.5 bg-slate-700/50 border border-slate-600/50 text-slate-300 rounded-lg text-sm font-medium transition-all hover:bg-slate-700"
          >
            <i class="bi bi-grid-3x3"></i> Kartu
          </button>
        </div>
      </div>
    </div>

    <!-- Results Info -->
    <div class="mt-4 flex items-center justify-between text-sm">
      <span class="text-slate-400">
        Menampilkan
        <span id="visibleCount" class="font-semibold text-amber-400"
          >{{ faults|length }}</span
        >
        dari {{ faults|length }} kerusakan
      </span>
      <button
        id="resetFilters"
        class="text-amber-400 hover:text-amber-300 transition-colors hidden"
      >
        <i class="bi bi-arrow-counterclockwise"></i> Reset
      </button>
    </div>
  </div>

  <!-- Table View -->
  <div
    id="tableView"
    class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 overflow-hidden fade-in-up stagger-2"
  >
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-slate-700/50 bg-slate-800/50">
            <th
              class="px-6 py-4 text-left text-sm font-semibold text-slate-300 w-32"
            >
              Kode
            </th>
            <th
              class="px-6 py-4 text-left text-sm font-semibold text-slate-300"
            >
              Nama Kerusakan
            </th>
          </tr>
        </thead>

        <tbody class="divide-y divide-slate-700/30" id="faultTableBody">
          {% for code, name in faults.items() %}
          <tr
            class="fault-row hover:bg-slate-800/30 transition-all duration-200 hover:scale-[1.01] cursor-pointer group"
            data-code="{{ code }}"
            data-name="{{ name }}"
          >
            <td class="px-6 py-4">
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-500/10 text-amber-400 border border-amber-500/20 group-hover:bg-amber-500/20 transition-colors"
              >
                {{ code }}
              </span>
            </td>
            <td class="px-6 py-4 text-slate-200 fault-name">{{ name }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Card View -->
  <div
    id="cardView"
    class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in-up stagger-2"
  >
    {% for code, name in faults.items() %}
    <div
      class="fault-card hover-lift bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 border border-slate-700/50 hover:border-amber-500/50 transition-all duration-300 cursor-pointer group"
      data-code="{{ code }}"
      data-name="{{ name }}"
    >
      <div class="flex items-start gap-4 mb-4">
        <div
          class="w-12 h-12 rounded-full bg-amber-500/10 flex items-center justify-center flex-shrink-0 group-hover:bg-amber-500/20 group-hover:scale-110 transition-all"
        >
          <i class="bi bi-exclamation-triangle text-2xl text-amber-400"></i>
        </div>
        <div class="flex-1">
          <span
            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-500/10 text-amber-400 border border-amber-500/20 mb-2"
          >
            {{ code }}
          </span>
        </div>
      </div>
      <h5
        class="text-lg font-semibold text-white group-hover:text-amber-400 transition-colors fault-card-name"
      >
        {{ name }}
      </h5>
    </div>
    {% endfor %}
  </div>

  <!-- No Results Message -->
  <div id="noResults" class="hidden mt-8 text-center py-12 fade-in-up">
    <div
      class="w-20 h-20 rounded-full bg-slate-800 flex items-center justify-center mx-auto mb-4"
    >
      <i class="bi bi-search text-4xl text-slate-500"></i>
    </div>
    <p class="text-slate-400 text-lg mb-2">Tidak ada kerusakan yang cocok</p>
    <p class="text-slate-500 text-sm">Coba gunakan kata kunci yang berbeda</p>
  </div>

  <!-- Back Button -->
  <div class="mt-8 fade-in-up stagger-3">
    <a
      href="/"
      class="inline-flex items-center gap-2 px-8 py-3 bg-slate-700/50 hover:bg-slate-700 text-slate-200 font-medium rounded-lg border border-slate-600/50 transition-all duration-300 hover:-translate-x-1"
    >
      <i class="bi bi-arrow-left"></i>
      Kembali
    </a>
  </div>
</div>

<script>
  const searchInput = document.getElementById("searchInput");
  const clearSearchBtn = document.getElementById("clearSearch");
  const resetFiltersBtn = document.getElementById("resetFilters");
  const tableViewBtn = document.getElementById("tableViewBtn");
  const cardViewBtn = document.getElementById("cardViewBtn");
  const tableView = document.getElementById("tableView");
  const cardView = document.getElementById("cardView");
  const faultRows = document.querySelectorAll(".fault-row");
  const faultCards = document.querySelectorAll(".fault-card");
  const noResults = document.getElementById("noResults");
  const visibleCount = document.getElementById("visibleCount");

  let currentView = "table";

  // Switch view mode
  function switchView(view) {
    currentView = view;

    if (view === "table") {
      tableView.classList.remove("hidden");
      cardView.classList.add("hidden");
      tableViewBtn.classList.add(
        "bg-amber-500/20",
        "border-amber-500/30",
        "text-amber-400"
      );
      tableViewBtn.classList.remove(
        "bg-slate-700/50",
        "border-slate-600/50",
        "text-slate-300"
      );
      cardViewBtn.classList.remove(
        "bg-amber-500/20",
        "border-amber-500/30",
        "text-amber-400"
      );
      cardViewBtn.classList.add(
        "bg-slate-700/50",
        "border-slate-600/50",
        "text-slate-300"
      );
    } else {
      tableView.classList.add("hidden");
      cardView.classList.remove("hidden");
      cardViewBtn.classList.add(
        "bg-amber-500/20",
        "border-amber-500/30",
        "text-amber-400"
      );
      cardViewBtn.classList.remove(
        "bg-slate-700/50",
        "border-slate-600/50",
        "text-slate-300"
      );
      tableViewBtn.classList.remove(
        "bg-amber-500/20",
        "border-amber-500/30",
        "text-amber-400"
      );
      tableViewBtn.classList.add(
        "bg-slate-700/50",
        "border-slate-600/50",
        "text-slate-300"
      );
    }

    filterFaults();
  }

  // Search functionality
  function filterFaults() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    let visible = 0;

    // Filter table rows
    faultRows.forEach((row) => {
      const code = row.dataset.code.toLowerCase();
      const name = row.dataset.name.toLowerCase();
      const matches = code.includes(searchTerm) || name.includes(searchTerm);

      if (matches) {
        row.style.display = "";
        visible++;
        highlightText(
          row.querySelector(".fault-name"),
          row.dataset.name,
          searchTerm
        );
      } else {
        row.style.display = "none";
      }
    });

    // Filter cards
    faultCards.forEach((card) => {
      const code = card.dataset.code.toLowerCase();
      const name = card.dataset.name.toLowerCase();
      const matches = code.includes(searchTerm) || name.includes(searchTerm);

      if (matches) {
        card.style.display = "";
        highlightText(
          card.querySelector(".fault-card-name"),
          card.dataset.name,
          searchTerm
        );
      } else {
        card.style.display = "none";
      }
    });

    updateUI(visible);

    // Show/hide clear button
    clearSearchBtn.classList.toggle("hidden", !searchTerm);
    resetFiltersBtn.classList.toggle("hidden", !searchTerm);
  }

  // Highlight matching text
  function highlightText(element, originalText, searchTerm) {
    if (searchTerm) {
      const regex = new RegExp(`(${searchTerm})`, "gi");
      element.innerHTML = originalText.replace(
        regex,
        '<mark class="bg-amber-400/30 text-amber-300 rounded px-1">$1</mark>'
      );
    } else {
      element.textContent = originalText;
    }
  }

  // Update UI
  function updateUI(visible) {
    visibleCount.textContent = visible;

    if (visible === 0) {
      noResults.classList.remove("hidden");
      if (currentView === "table") {
        tableView.style.opacity = "0.3";
      } else {
        cardView.style.opacity = "0.3";
      }
    } else {
      noResults.classList.add("hidden");
      if (currentView === "table") {
        tableView.style.opacity = "1";
      } else {
        cardView.style.opacity = "1";
      }
    }
  }

  // Clear search
  function clearSearch() {
    searchInput.value = "";
    clearSearchBtn.classList.add("hidden");
    filterFaults();
  }

  // Reset filters
  function resetFilters() {
    searchInput.value = "";
    clearSearchBtn.classList.add("hidden");
    resetFiltersBtn.classList.add("hidden");
    filterFaults();
  }

  // Event listeners
  searchInput.addEventListener("input", filterFaults);
  clearSearchBtn.addEventListener("click", clearSearch);
  resetFiltersBtn.addEventListener("click", resetFilters);
  tableViewBtn.addEventListener("click", () => switchView("table"));
  cardViewBtn.addEventListener("click", () => switchView("card"));

  // Row/Card click animation
  faultRows.forEach((row) => {
    row.addEventListener("click", function () {
      this.style.transform = "scale(1.02)";
      setTimeout(() => {
        this.style.transform = "scale(1)";
      }, 200);
    });
  });

  faultCards.forEach((card) => {
    card.addEventListener("click", function () {
      this.style.transform = "translateY(-8px)";
      setTimeout(() => {
        this.style.transform = "translateY(-5px)";
      }, 200);
    });
  });

  // Keyboard shortcuts
  document.addEventListener("keydown", (e) => {
    // Focus search on Ctrl/Cmd + K
    if ((e.ctrlKey || e.metaKey) && e.key === "k") {
      e.preventDefault();
      searchInput.focus();
    }

    // Clear search on Escape
    if (e.key === "Escape" && searchInput.value) {
      clearSearch();
    }

    // Toggle view on V key
    if (e.key === "v" || e.key === "V") {
      switchView(currentView === "table" ? "card" : "table");
    }
  });
</script>

{% endblock %}
