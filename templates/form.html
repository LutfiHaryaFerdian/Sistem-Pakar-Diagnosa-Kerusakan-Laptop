{% extends "base.html" %} {% block content %}

<div class="max-w-6xl mx-auto">
  <div class="mb-8">
    <h3 class="text-3xl font-bold text-white mb-2">
      Form Diagnosa Kerusakan Laptop
    </h3>
    <p class="text-slate-400">
      Pilih intensitas untuk setiap gejala yang dialami
    </p>
  </div>

  <!-- Search & Filter Section -->
  <div
    class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 p-6 mb-6"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Search Bar -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">
          <i class="bi bi-search"></i> Cari Gejala
        </label>
        <input
          type="text"
          id="searchInput"
          placeholder="Ketik untuk mencari gejala..."
          class="bg-slate-700/50 border border-slate-600/50 text-slate-200 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-2.5 transition-all"
        />
      </div>

      <!-- Category Filter -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">
          <i class="bi bi-funnel"></i> Filter Kategori
        </label>
        <select
          id="categoryFilter"
          class="bg-slate-700/50 border border-slate-600/50 text-slate-200 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-2.5 transition-all"
        >
          <option value="all">Semua Kategori</option>
          <option value="Hardware">Hardware</option>
          <option value="Software">Software</option>
          <option value="BIOS">BIOS</option>
          <option value="Power">Power</option>
          <option value="Other">Lainnya</option>
        </select>
      </div>
    </div>

    <!-- Active Filters Display -->
    <div id="activeFilters" class="mt-4 flex flex-wrap gap-2"></div>
  </div>

  <form method="POST" action="/diagnose">
    <div
      class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700/50 overflow-hidden"
    >
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-slate-700/50 bg-slate-800/50">
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-slate-300"
              >
                Kode
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-slate-300"
              >
                Gejala
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-slate-300"
              >
                Kategori
              </th>
              <th
                class="px-6 py-4 text-left text-sm font-semibold text-slate-300"
              >
                Intensitas
              </th>
            </tr>
          </thead>

          <tbody class="divide-y divide-slate-700/30" id="symptomTableBody">
            {% for code, name in symptoms.items() %}
            <tr
              class="symptom-row hover:bg-slate-800/30 transition-colors"
              data-code="{{ code }}"
              data-name="{{ name }}"
              data-category="{{ symptom_categories.get(code, 'Other') }}"
            >
              <td class="px-6 py-4">
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20"
                >
                  {{ code }}
                </span>
              </td>
              <td class="px-6 py-4 text-slate-200">{{ name }}</td>
              <td class="px-6 py-4">
                <span
                  class="category-badge inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-500/10 text-purple-400"
                >
                  {{ symptom_categories.get(code, 'Other') }}
                </span>
              </td>
              <td class="px-6 py-4">
                <select
                  name="{{ code }}"
                  class="bg-slate-700/50 border border-slate-600/50 text-slate-200 text-sm rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 block w-full px-4 py-2.5 transition-all"
                >
                  <option value="0">Tidak Ada</option>
                  <option value="0.25">Jarang</option>
                  <option value="0.5">Cukup Sering</option>
                  <option value="0.75">Sering</option>
                  <option value="1">Sangat Sering</option>
                </select>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- No Results Message -->
    <div id="noResults" class="hidden mt-4 text-center py-8">
      <i class="bi bi-search text-4xl text-slate-500"></i>
      <p class="text-slate-400 mt-2">
        Tidak ada gejala yang cocok dengan pencarian Anda
      </p>
    </div>

    <div class="flex gap-4 mt-8">
      <button
        type="submit"
        class="px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-medium rounded-lg shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 transition-all duration-300 flex items-center gap-2"
      >
        <i class="bi bi-search"></i>
        Proses Diagnosa
      </button>
      <a
        href="/"
        class="px-8 py-3 bg-slate-700/50 hover:bg-slate-700 text-slate-200 font-medium rounded-lg border border-slate-600/50 transition-all duration-300 flex items-center gap-2"
      >
        <i class="bi bi-arrow-left"></i>
        Kembali
      </a>
    </div>
  </form>
</div>

<script>
  // Search and Filter functionality
  const searchInput = document.getElementById("searchInput");
  const categoryFilter = document.getElementById("categoryFilter");
  const symptomRows = document.querySelectorAll(".symptom-row");
  const noResults = document.getElementById("noResults");
  const symptomTableBody = document.getElementById("symptomTableBody");

  function filterSymptoms() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;
    let visibleCount = 0;

    symptomRows.forEach((row) => {
      const code = row.dataset.code.toLowerCase();
      const name = row.dataset.name.toLowerCase();
      const category = row.dataset.category;

      const matchesSearch =
        code.includes(searchTerm) || name.includes(searchTerm);
      const matchesCategory =
        selectedCategory === "all" || category === selectedCategory;

      if (matchesSearch && matchesCategory) {
        row.style.display = "";
        visibleCount++;
      } else {
        row.style.display = "none";
      }
    });

    // Show/hide no results message
    if (visibleCount === 0) {
      noResults.classList.remove("hidden");
      symptomTableBody.parentElement.parentElement.style.display = "none";
    } else {
      noResults.classList.add("hidden");
      symptomTableBody.parentElement.parentElement.style.display = "";
    }

    updateActiveFilters(searchTerm, selectedCategory);
  }

  function updateActiveFilters(searchTerm, category) {
    const activeFilters = document.getElementById("activeFilters");
    activeFilters.innerHTML = "";

    if (searchTerm) {
      const badge = document.createElement("span");
      badge.className =
        "inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium bg-blue-500/20 text-blue-300 border border-blue-500/30";
      badge.innerHTML = `
      <i class="bi bi-search"></i>
      "${searchTerm}"
      <button onclick="clearSearch()" class="ml-1 hover:text-blue-100">
        <i class="bi bi-x"></i>
      </button>
    `;
      activeFilters.appendChild(badge);
    }

    if (category !== "all") {
      const badge = document.createElement("span");
      badge.className =
        "inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium bg-purple-500/20 text-purple-300 border border-purple-500/30";
      badge.innerHTML = `
      <i class="bi bi-funnel"></i>
      ${category}
      <button onclick="clearCategory()" class="ml-1 hover:text-purple-100">
        <i class="bi bi-x"></i>
      </button>
    `;
      activeFilters.appendChild(badge);
    }
  }

  function clearSearch() {
    searchInput.value = "";
    filterSymptoms();
  }

  function clearCategory() {
    categoryFilter.value = "all";
    filterSymptoms();
  }

  // Event listeners
  searchInput.addEventListener("input", filterSymptoms);
  categoryFilter.addEventListener("change", filterSymptoms);

  // Auto-complete feature (highlight matching text)
  searchInput.addEventListener("input", function () {
    const searchTerm = this.value.toLowerCase();
    symptomRows.forEach((row) => {
      const nameCell = row.querySelector("td:nth-child(2)");
      const originalText = row.dataset.name;

      if (searchTerm && originalText.toLowerCase().includes(searchTerm)) {
        const regex = new RegExp(`(${searchTerm})`, "gi");
        nameCell.innerHTML = originalText.replace(
          regex,
          '<mark class="bg-yellow-400/30 text-yellow-300">$1</mark>'
        );
      } else {
        nameCell.textContent = originalText;
      }
    });
  });
</script>

{% endblock %}
